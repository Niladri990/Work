<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ConservencyDriver</title>
<style>
  :root {
    --uber-green: #06C167;
    --uber-white: #ffffff;
    --uber-gray: #f8f9fa;
    --border-radius: 10px;
    --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.10);
    --accent-orange: #fd7e14;
    --gov-blue: #004085;
    --text-primary: #1c1c1c;
    --text-secondary: #6c757d;
  }
  body, html {
    margin: 0; padding: 0;
    font-family: 'Uber Move', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--uber-gray);
    color: var(--text-primary);
    min-height: 100vh;
  }
  header {
    background-color: var(--uber-black);
    color: var(--uber-black);
    padding: 1rem 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
  }
  header h1 {
    flex-grow: 1;
    font-weight: 700;
    font-size: 1.8rem;
    margin: 0;
  }
  #onlineToggle {
    background-color: var(--uber-green);
    color: var(--uber-black);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s ease;
  }
  #onlineToggle.offline {
    background-color: var(--uber-red);
  }
  #profileBtn {
    background: none;
    border: none;
    color: var(--uber-black);
    cursor: pointer;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }
  #profileBtn svg {
    width: 24px;
    height: 24px;
    fill: currentColor;
  }
  #notificationBtn {
    background: none;
    border: none;
    color: var(--uber-black);
    cursor: pointer;
    font-size: 1.25rem;
    position: relative;
    margin-left: auto;
    margin-right: 1rem;
  }
  #notificationBtn svg {
    width: 28px;
    height: 28px;
    fill: currentColor;
  }
  #notificationBadge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--uber-red);
    color: var(--uber-black);
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 0.75rem;
    font-weight: 700;
  }
  nav {
    background: var(--uber-black);
    display: flex;
    justify-content: center;
    border-bottom: 5px solid var(--uber-green);
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    flex-wrap: wrap;
  }
  nav button {
    background: none;
    border: none;
    color: var(--uber-black);
    font-weight: 700;
    font-size: 1rem;
    padding: 1rem 1.5rem;
    cursor: pointer;
    transition: border-bottom 0.3s ease, background-color 0.3s ease;
    border-bottom: 3px solid transparent;
    flex: 1 1 auto;
    max-width: 140px;
  }
  nav button.active, nav button:hover {
    border-bottom: 3px solid var(--uber-green);
    background-color: var(--uber-black);
    color: var(--uber-green);
  }
  main.container {
    max-width: 980px;
    margin: 2rem auto;
    background: var(--uber-black);
    border-radius: var(--border-radius);
    padding: 2rem 2.5rem;
    box-shadow: var(--box-shadow);
    min-height: 60vh;
  }
  h2 {
    color: var(--gov-blue);
    border-bottom: 3px solid var(--accent-orange);
    padding-bottom: 0.3rem;
    margin-top: 0;
    margin-bottom: 1.5rem;
  }
  /* Notification panel */
  #notificationPanel {
    position: fixed;
    top: 60px;
    right: 20px;
    width: 320px;
    max-height: 400px;
    background: var(--uber-white);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    overflow-y: auto;
    display: none;
    z-index: 1000;
  }
  #notificationPanel h3 {
    margin: 0;
    padding: 1rem;
    background: var(--gov-blue);
    color: var(--uber-white);
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
  }
  #notificationList {
    list-style: none;
    margin: 0;
    padding: 0.5rem 1rem 1rem 1rem;
  }
  #notificationList li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #ddd;
    cursor: pointer;
  }
  #notificationList li:last-child {
    border-bottom: none;
  }
  #notificationList li.unread {
    font-weight: 700;
    background-color: #f0f8ff;
  }
  /* Buttons */
  .btn-container {
    margin-top: 1rem;
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
    align-items: center;
  }
  #pageContent .submit-btn {
    margin-top: 1rem;
    margin-bottom: 1rem;
    margin-right: 2rem;
    display: inline-flex;
  }
  #pageContent .submit-btn:last-child {
    margin-right: 0;
  }
  button.submit-btn, button.gps-btn {
    background-color: var(--accent-orange);
    color: var(--uber-white);
    font-weight: 900;
    font-size: 1.1rem;
    padding: 1rem 2rem;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }
  button.submit-btn:hover, button.gps-btn:hover {
    background-color: #1bab38;
  }
  button.submit-btn:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }
  /* Sophisticated account/profile form styling */
  #profileForm {
    max-width: 550px;
    margin: 2.7rem auto 0 auto;
    padding: 2rem 1.5rem 0 1.5rem;
    background: #f4f8fc;
    border-radius: 20px;
    box-shadow: 0 1px 14px 0 rgba(0,16,65,.08);
  }
  #profileForm label {
    display: block;
    font-weight: 700;
    color: #22314A;
    padding-bottom: 0.3rem;
    margin-top: 2.1rem;
    letter-spacing: 0.01em;
    font-size: 1.1rem;
  }
  #profileForm input[type="text"],
  #profileForm input[type="number"],
  #profileForm input[type="tel"],
  #profileForm input[type="email"] {
    width: 100%;
    font-size: 1.23rem;
    padding: 1.2rem 1.1rem;
    border: 1.8px solid #daf3fa;
    border-radius: 13px;
    background: #ffffff;
    color: #22314a;
    margin-top: 0.25rem;
    box-sizing: border-box;
    margin-bottom: 0.1rem;
    outline: none;
    box-shadow: 0 2px 12px 0 rgba(0,16,65,0.04);
    transition: border 0.2s, box-shadow 0.18s;
    font-weight: 400;
    letter-spacing: 0.004em;
  }
  #profileForm input:focus {
    border: 2.4px solid #fd7e14;
    background: #fef9f7;
    box-shadow: 0 4px 16px 0 rgba(253,126,20,.09);
  }
  #profileForm input[type="number"] {
    appearance: textfield;
    -moz-appearance: textfield;
  }
  #profileForm input::placeholder {
    color: #abc2d3;
    font-size: 1.17rem;
    opacity: 1;
    font-weight: 400;
    letter-spacing: 0.01em;
  }
  @media (max-width: 700px) {
    main.container {
      padding: 1rem 0.4rem;
    }
    #profileForm {
      max-width: 99vw; padding: 1.3rem 0.45rem 0 0.45rem;
    }
  }
  @media (max-width: 480px) {
    nav button {
      padding: 0.8rem 1rem;
      font-size: 0.9rem;
    }
    .btn-container {
      flex-direction: column;
    }
    button.submit-btn, button.gps-btn, #pageContent .submit-btn {
      width: 100%;
      margin-right: 0;
    }
    #profileForm {
      padding: 0.6rem 0.10rem 0 0.10rem;
      border-radius: 0;
    }
  }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css" />
<script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
</head>
<body>

<header>
  <h1>Conservency Driver</h1>
  <button id="notificationBtn" aria-label="Notifications" title="Notifications" onclick="toggleNotificationPanel()">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
      <path d="M12 22c1.1 0 2-.9 2-2h-4a2 2 0 0 0 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4a1.5 1.5 0 0 0-3 0v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
    </svg>
    <span id="notificationBadge" style="display:none;">0</span>
  </button>
  <button id="onlineToggle" onclick="toggleOnlineStatus()" aria-pressed="false">Go Online</button>
  <button id="profileBtn" onclick="window.location.href='profile.html'" aria-label="Profile" title="Profile">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
      <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
    </svg>
    Profile
  </button>
</header>

<nav>
  <button class="active" onclick="navigateTo('home')">Home</button>
  <button onclick="navigateTo('earnings')">Earnings</button>
  <button onclick="navigateTo('trips')">Trips</button>
</nav>

<main class="container" id="pageContent">
  <!-- Dynamic content loads here -->
</main>

<div id="notificationPanel" role="region" aria-live="polite" aria-label="Notifications">
  <h3>Notifications</h3>
  <ul id="notificationList" tabindex="0">
    <!-- Notifications will be dynamically inserted here -->
  </ul>
</div>

<script>
  let isOnline = false;
  let totalEarnings = 350;
  let trips = [
    { date: '2024-06-10', location: '123 Main St', amount: 150 },
    { date: '2024-06-11', location: '456 Oak Ave', amount: 200 }
  ];
  let notifications = [
    { id: 1, message: "New booking assigned: Pickup at 123 Main St.", read: false },
    { id: 2, message: "Schedule updated for tomorrow.", read: false },
    { id: 3, message: "Reminder: Vehicle maintenance due next week.", read: true }
  ];

  // Garbage orders data
  let garbageOrders = [
    { id: 1, address: "123 Main St, Delhi", lat: 28.6448, lng: 77.2167, time: "10:00 AM", status: "Pending", type: "Household Waste" },
    { id: 2, address: "456 Oak Ave, Delhi", lat: 28.6455, lng: 77.2200, time: "11:30 AM", status: "Pending", type: "Recyclables" },
    { id: 3, address: "789 Pine Rd, Delhi", lat: 28.6460, lng: 77.2250, time: "2:00 PM", status: "Pending", type: "Organic Waste" }
  ];

  function toggleOnlineStatus() {
    isOnline = !isOnline;
    const button = document.getElementById('onlineToggle');
    if (isOnline) {
      button.textContent = 'Go Offline';
      button.classList.remove('offline');
      button.setAttribute('aria-pressed', 'true');
      document.body.style.backgroundColor = '#f0f8ff';
      // Notify Green Center
      localStorage.setItem('conservency_notification', JSON.stringify({
        message: "Conservency Driver is now online and ready for waste collection.",
        timestamp: new Date()
      }));
    } else {
      button.textContent = 'Go Online';
      button.classList.add('offline');
      button.setAttribute('aria-pressed', 'false');
      document.body.style.backgroundColor = 'var(--uber-gray)';
      // Notify Green Center
      localStorage.setItem('conservency_notification', JSON.stringify({
        message: "Conservency Driver has gone offline.",
        timestamp: new Date()
      }));
    }
  }

  function toggleNotificationPanel() {
    const panel = document.getElementById('notificationPanel');
    if (panel.style.display === 'block') {
      panel.style.display = 'none';
    } else {
      panel.style.display = 'block';
      markAllNotificationsRead();
    }
  }

  function renderNotifications() {
    const list = document.getElementById('notificationList');
    list.innerHTML = '';
    notifications.forEach(n => {
      const li = document.createElement('li');
      li.textContent = n.message;
      li.className = n.read ? '' : 'unread';
      li.tabIndex = 0;
      li.onclick = () => {
        n.read = true;
        renderNotifications();
        updateNotificationBadge();
      };
      list.appendChild(li);
    });
  }

  function updateNotificationBadge() {
    const badge = document.getElementById('notificationBadge');
    const unreadCount = notifications.filter(n => !n.read).length;
    if (unreadCount > 0) {
      badge.style.display = 'inline-block';
      badge.textContent = unreadCount;
    } else {
      badge.style.display = 'none';
    }
  }

  function markAllNotificationsRead() {
    notifications.forEach(n => n.read = true);
    renderNotifications();
    updateNotificationBadge();
  }

  // Navigation and page rendering
  function navigateTo(page) {
    document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
    const btn = Array.from(document.querySelectorAll('nav button')).find(b => b.textContent.toLowerCase() === page.toLowerCase());
    if (btn) btn.classList.add('active');

    switch(page) {
      case 'home': renderHome(); break;
      case 'earnings': renderEarnings(); break;
      case 'trips': renderTrips(); break;
      default: renderHome();
    }
  }

  // Earnings page showing total earnings and trips
  function renderEarnings() {
    let html = `<h2>Earnings</h2>`;
    html += `<p><strong>Total Earnings:</strong> ₹${totalEarnings.toFixed(2)}</p>`;
    if (trips.length === 0) {
      html += `<p>No trips recorded yet.</p>`;
    } else {
      html += `<ul>`;
      trips.forEach(trip => {
        html += `<li>${trip.date} - ₹${trip.amount.toFixed(2)}</li>`;
      });
      html += `</ul>`;
    }
    document.getElementById('pageContent').innerHTML = html;
  }

  // Trips page showing list of trips
  function renderTrips() {
    let html = `<h2>Trips</h2>`;
    if (trips.length === 0) {
      html += `<p>No trips recorded yet.</p>`;
    } else {
      html += `<ul>`;
      trips.forEach(trip => {
        html += `<li>${trip.date} - Pickup at ${trip.location} - ₹${trip.amount.toFixed(2)}</li>`;
      });
      html += `</ul>`;
    }
    document.getElementById('pageContent').innerHTML = html;
  }



  // Home page with map and orders
  function renderHome() {
    let ordersHtml = '<h3>Garbage Collection Orders</h3><ul>';
    garbageOrders.forEach(order => {
      ordersHtml += `<li onclick="handleOrderClick(${order.id})" style="cursor:pointer; padding:0.5rem; border-bottom:1px solid #ddd;">
        <strong>${order.address}</strong> - ${order.time} - ${order.type} - <span style="color:${order.status === 'Pending' ? 'orange' : 'green'};">${order.status}</span>
      </li>`;
    });
    ordersHtml += '</ul>';

    document.getElementById('pageContent').innerHTML = `
      <h2>Home</h2>
      <div style="display:flex; gap:2rem; flex-wrap:wrap;">
        <div style="flex:1; min-width:300px;">
          <p>Track your location on the map.</p>
          <div id="map" style="width: 100%; height: 400px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); margin-top: 1rem;"></div>
          <div id="driverStatus" style="margin-top: 1rem; font-weight: bold; font-size: 1.1rem; color: var(--gov-blue);">
            Driver status: <span id="driverStatusText">Ready for waste collection.</span>
          </div>
          <button onclick="startDriverSimulation()" class="submit-btn" style="margin-top: 1rem;">Start Driver Simulation</button>
          <button onclick="stopDriverSimulation()" class="submit-btn" style="margin-top: 1rem; margin-left: 1rem;">Stop Simulation</button>
        </div>
        <div style="flex:1; min-width:300px;">
          ${ordersHtml}
        </div>
      </div>
    `;
    initializeMap();
  }

  // Driver tracking page with map and status
  let map, driverMarker, simulationInterval;
  const driverPath = [
    {lat: 28.6448, lng: 77.2167},
    {lat: 28.6455, lng: 77.2200},
    {lat: 28.6460, lng: 77.2250},
    {lat: 28.6470, lng: 77.2300},
    {lat: 28.6480, lng: 77.2350},
    {lat: 28.6490, lng: 77.2400},
    {lat: 28.6500, lng: 77.2450},
    {lat: 28.6510, lng: 77.2500},
    {lat: 28.6520, lng: 77.2550},
    {lat: 28.6530, lng: 77.2600},
  ];
  let currentDriverIndex = 0;
  const driverStatuses = [
    "Driver is starting from the depot.",
    "Driver is en route to waste pickup location.",
    "Driver has arrived at waste pickup location.",
    "Driver is picking up waste.",
    "Driver is en route to green center.",
    "Waste delivered to green center."
  ];

  function initializeMap() {
    const startCoord = ol.proj.fromLonLat([driverPath[0].lng, driverPath[0].lat]);
    map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        })
      ],
      view: new ol.View({
        center: startCoord,
        zoom: 14
      })
    });

    const driverFeature = new ol.Feature({
      geometry: new ol.geom.Point(startCoord)
    });

    driverFeature.setStyle(new ol.style.Style({
      image: new ol.style.Circle({
        radius: 8,
        fill: new ol.style.Fill({color: 'orange'}),
        stroke: new ol.style.Stroke({color: 'white', width: 2})
      })
    }));

    const features = [driverFeature];

    // Add order markers
    garbageOrders.forEach(order => {
      const orderCoord = ol.proj.fromLonLat([order.lng, order.lat]);
      const orderFeature = new ol.Feature({
        geometry: new ol.geom.Point(orderCoord),
        orderId: order.id
      });
      orderFeature.setStyle(new ol.style.Style({
        image: new ol.style.Icon({
          src: 'data:image/svg+xml;base64,' + btoa('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="' + (order.status === 'Pending' ? 'red' : 'green') + '" stroke="white" stroke-width="2"/></svg>'),
          scale: 1
        })
      }));
      features.push(orderFeature);
    });

    const vectorSource = new ol.source.Vector({
      features: features
    });
    const vectorLayer = new ol.layer.Vector({
      source: vectorSource
    });
    map.addLayer(vectorLayer);

    driverMarker = driverFeature;

    // Add click event for order markers
    map.on('click', function(evt) {
      const feature = map.forEachFeatureAtPixel(evt.pixel, function(feature) {
        return feature;
      });
      if (feature && feature.get('orderId')) {
        handleOrderClick(feature.get('orderId'));
      }
    });
  }

  function animateMarker(marker, fromLatLng, toLatLng, duration) {
    const start = performance.now();
    const fromCoord = ol.proj.fromLonLat([fromLatLng.lng, fromLatLng.lat]);
    const toCoord = ol.proj.fromLonLat([toLatLng.lng, toLatLng.lat]);

    function easeInOutQuad(t) {
      return t < 0.5 ? 2*t*t : -1+(4-2*t)*t;
    }

    function animate(time) {
      const elapsed = time - start;
      const t = Math.min(elapsed / duration, 1);
      const easedT = easeInOutQuad(t);

      const currentX = fromCoord[0] + (toCoord[0] - fromCoord[0]) * easedT;
      const currentY = fromCoord[1] + (toCoord[1] - fromCoord[1]) * easedT;

      marker.getGeometry().setCoordinates([currentX, currentY]);
      map.getView().setCenter([currentX, currentY]);

      if (t < 1) {
        requestAnimationFrame(animate);
      }
    }
    requestAnimationFrame(animate);
  }

  function startDriverSimulation() {
    if (simulationInterval) return;
    currentDriverIndex = 0;
    updateDriverStatus();

  function moveNext() {
    if (currentDriverIndex + 1 >= driverPath.length) {
      document.getElementById('driverStatusText').textContent = "Waste delivered to green center.";
      // Notify Green Center
      localStorage.setItem('conservency_notification', JSON.stringify({
        message: "Conservency Driver has completed waste collection and delivered to green center.",
        timestamp: new Date()
      }));
      simulationInterval = null;
      return;
    }
      const from = driverPath[currentDriverIndex];
      const to = driverPath[currentDriverIndex + 1];
      animateMarker(driverMarker, from, to, 2800);
      currentDriverIndex++;
      updateDriverStatus();
      simulationInterval = setTimeout(moveNext, 3000);
    }
    moveNext();
  }

  function stopDriverSimulation() {
    if (simulationInterval) {
      clearInterval(simulationInterval);
      simulationInterval = null;
      document.getElementById('driverStatusText').textContent = "Waste collection simulation stopped.";
    }
  }

  function updateDriverStatus() {
    let statusIndex = Math.min(currentDriverIndex, driverStatuses.length - 1);
    document.getElementById('driverStatusText').textContent = driverStatuses[statusIndex];
    const statusElem = document.getElementById('driverStatusText');
    statusElem.style.opacity = 0;
    setTimeout(() => {
      statusElem.style.transition = 'opacity 0.5s ease-in-out';
      statusElem.style.opacity = 1;
    }, 100);
  }

  // Initialize app
  window.onload = () => {
    updateNotificationBadge();
    renderNotifications();
    navigateTo('home');
  };
</script>

</body>
</html>
